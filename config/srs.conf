# SRS Configuration File
# Reference: https://ossrs.io/lts/en-us/docs/v6/category/main-protocols

# Global Server Configurations
listen              1935;                             # RTMP Listen Port
max_connections     1000;                             # Maximum number of RTMP connections

# Logging configuration
srs_log_tank        console;
srs_log_file        /usr/local/srs/logs/srs.log;
srs_log_level       trace;

# HTTP API and Stream Statistics
http_api {
    enabled         on;                               # Enable SRS HTTP API
    listen          1985;                             # HTTP API port
    crossdomain     on;                               # Enable crossdomain requests
}

# HTTP Server for HLS/DASH
http_server {
    enabled         on;                               # Enable HTTP server
    listen          8080;                             # HTTP port
    dir             /usr/local/srs/objs/nginx/html;   # Path for static files like HLS
}

# RTC (WebRTC) Server Configuration
rtc_server {
    enabled         on;                               # Enable WebRTC
    listen          10080;                            # WebRTC Media Transport Port (UDP)
    protocol        udp;
    candidate       *;                                # Use all available interfaces
}

# Virtual Host Configuration
vhost __defaultVhost__ {
    # RTMP settings
    gop_cache       on;                               # Enable GOP caching
    queue_length    30;                               # Maximum queue length

    # HLS Configuration
    hls {
        enabled         on;                           # Enable HLS (HTTP Live Streaming)
        hls_path        /usr/local/srs/objs/nginx/html; # HLS output directory
        hls_fragment    10;                            # HLS: Set segment duration to 10 seconds
        hls_window      60;                            # HLS: Set playlist window to 60 seconds
    }

    # HTTP Callback Hooks
    http_hooks {
        enabled         on;
        on_publish      http://host.docker.internal:8081/api/rtmp/published;  # Must use host.docker.internal instead of localhost
        on_unpublish    http://host.docker.internal:8081/api/rtmp/unpublished;
    }

    # RTMP Applications
    play {
        gop_cache       on;                           # Enable GOP caching
    }
}